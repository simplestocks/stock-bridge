<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Stocks Super Tool</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

    <div class="dashboard-container">
        <div class="search-bar">
            <div class="logo">$ SIMPLE STOCKS</div>
            <input type="text" id="tickerInput" placeholder="ENTER TICKER (e.g. NVDA)" onkeyup="handleEnter(event)">
            <button onclick="runAnalysis()">ANALYZE</button>
        </div>

        <div class="grid-layout">
            
            <div class="zone-visual">
                <div class="zone-header">CHART</div>
                <div id="tv-chart-container"></div> 
            </div>

            <div class="right-column">
                
                <div class="zone-vitals">
                    <div class="zone-header">VALIDATOR & VITALS</div>
                    
                    <div id="signal-box" class="signal-box">
                        STATUS: <span id="val-signal">WAITING...</span>
                    </div>

                    <div id="vitals-content" class="data-grid">
                        <div class="metric-box">
                            <span class="label">PRICE</span>
                            <span class="value" id="val-price">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">RSI (14)</span>
                            <span class="value" id="val-rsi">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">TREND (200 SMA)</span>
                            <span class="value" id="val-trend">--</span>
                        </div>
                         <div class="metric-box">
                            <span class="label">MKT CAP</span>
                            <span class="value" id="val-mktcap">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">P/E RATIO</span>
                            <span class="value" id="val-pe">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">DIV YIELD</span>
                            <span class="value" id="val-div">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">SALES G/Y</span>
                            <span class="value" id="val-sales">--</span>
                        </div>
                        <div class="metric-box">
                            <span class="label">EPS G/Y</span>
                            <span class="value" id="val-eps">--</span>
                        </div>
                    </div>
                </div>

                <div class="zone-pulse">
                    <div class="zone-header">MARKET PULSE (AI SENTIMENT)</div>
                    <div id="news-feed" class="news-list">
                        <div class="placeholder-text">ENTER TICKER TO SCAN.</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="script.js"></script>
</body>
</html>

<style>
/* CSS RESET & BASICS */
body {
    background-color: #000;
    color: #fff;
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    overflow-x: hidden; /* Prevent horizontal scroll */
}

/* INPUT SECTION */
.search-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    align-items: center;
}
.logo {
    font-weight: 900;
    font-size: 20px;
    letter-spacing: 1px;
    color: #fff;
    white-space: nowrap;
}
input {
    background: #111;
    border: 1px solid #333;
    color: #fff;
    padding: 15px;
    font-size: 16px;
    font-weight: bold;
    text-transform: uppercase;
    flex-grow: 1;
    border-radius: 4px;
    outline: none;
}
input:focus { border-color: #555; }

button {
    background: #00ff00;
    color: #000;
    border: none;
    padding: 0 30px;
    height: 50px;
    font-weight: 900;
    cursor: pointer;
    font-size: 16px;
    border-radius: 4px;
    transition: 0.2s;
}
button:hover { background: #fff; }

/* LAYOUT GRID */
.grid-layout {
    display: grid;
    grid-template-columns: 1.5fr 1fr; /* 60% Chart, 40% Data */
    gap: 20px;
    height: 80vh; /* Fill most of screen */
}

/* ZONES */
.zone-visual, .zone-vitals, .zone-pulse {
    background: #0a0a0a;
    border: 1px solid #222;
    border-radius: 6px;
    padding: 15px;
    display: flex;
    flex-direction: column;
}

.right-column {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 100%;
}

.zone-vitals { flex: 0 0 auto; } /* Fits content */
.zone-pulse { flex: 1 1 auto; overflow-y: auto; } /* Takes remaining space */

.zone-header {
    font-size: 12px;
    color: #666;
    font-weight: 700;
    letter-spacing: 1px;
    margin-bottom: 15px;
    text-transform: uppercase;
    border-bottom: 1px solid #222;
    padding-bottom: 5px;
}

/* CHART */
#tv-chart-container {
    flex-grow: 1;
    height: 100%;
    min-height: 400px;
}

/* SIGNAL BOX (The Validator Result) */
.signal-box {
    background: #111;
    padding: 15px;
    text-align: center;
    border: 1px solid #333;
    border-radius: 4px;
    margin-bottom: 15px;
    font-weight: bold;
    font-size: 14px;
    color: #888;
}
.signal-box span {
    display: block;
    font-size: 24px;
    margin-top: 5px;
    color: #fff;
    font-weight: 900;
}

/* VITALS GRID */
.data-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 Columns */
    gap: 10px;
}
.metric-box {
    background: #000;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 4px;
}
.label { display: block; font-size: 10px; color: #666; margin-bottom: 4px; text-transform: uppercase; }
.value { font-size: 16px; font-weight: bold; color: #fff; }

/* NEWS FEED */
.news-item {
    margin-bottom: 15px;
    border-bottom: 1px solid #222;
    padding-bottom: 10px;
}
.news-meta { font-size: 10px; color: #666; display: flex; justify-content: space-between; margin-bottom: 5px; }
.news-title { font-size: 14px; color: #ddd; line-height: 1.4; text-decoration: none; display: block; }
.news-title:hover { color: #00ff00; }
.sentiment-tag { padding: 2px 6px; border-radius: 3px; font-weight: bold; font-size: 10px; }

/* UTILS */
.bullish { color: #00ff00 !important; }
.bearish { color: #ff0055 !important; }
.bg-bull { background: rgba(0, 255, 0, 0.1); color: #00ff00; }
.bg-bear { background: rgba(255, 0, 85, 0.1); color: #ff0055; }
.placeholder-text { color: #444; font-style: italic; text-align: center; margin-top: 20px; }

/* MOBILE */
@media (max-width: 900px) {
    .grid-layout { grid-template-columns: 1fr; height: auto; }
    #tv-chart-container { min-height: 350px; }
}
</style>

<script>
// --- CONFIGURATION ---
const API_KEY = "C9E1N388LHHS9E5O"; // NIC'S KEY

// --- MAIN FUNCTION ---
async function runAnalysis() {
    const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
    if(!ticker) return;

    // Reset UI
    document.getElementById('val-signal').innerText = "LOADING...";
    document.getElementById('val-signal').className = "";

    // 1. UPDATE CHART (TradingView)
    updateChart(ticker);

    // 2. FETCH DATA (Parallel Execution for Speed)
    try {
        await Promise.all([
            fetchFundamentals(ticker),
            fetchTechnicalLogic(ticker),
            fetchNews(ticker)
        ]);
    } catch (error) {
        console.error("API Error:", error);
        document.getElementById('val-signal').innerText = "API ERROR";
    }
}

function handleEnter(e) {
    if(e.key === 'Enter') runAnalysis();
}

// --- TRADINGVIEW WIDGET ---
function updateChart(ticker) {
    document.getElementById('tv-chart-container').innerHTML = ""; 
    new TradingView.widget({
        "container_id": "tv-chart-container",
        "autosize": true,
        "symbol": ticker,
        "interval": "D",
        "timezone": "Etc/UTC",
        "theme": "dark",
        "style": "1", // Candles
        "locale": "en",
        "toolbar_bg": "#f1f3f6",
        "enable_publishing": false,
        "allow_symbol_change": true,
        "hide_top_toolbar": false,
        "hide_volume": true
    });
}

// --- ALPHA VANTAGE: FUNDAMENTALS (Overview) ---
async function fetchFundamentals(ticker) {
    const url = `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${ticker}&apikey=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();

    if(data.Symbol) {
        updateDOM('val-mktcap', formatNumber(data.MarketCapitalization));
        updateDOM('val-pe', data.PERatio);
        updateDOM('val-div', (data.DividendYield * 100).toFixed(2) + '%');
        updateDOM('val-sales', data.QuarterlyRevenueGrowthYOY + '%');
        updateDOM('val-eps', data.QuarterlyEarningsGrowthYOY + '%');
    }
}

// --- ALPHA VANTAGE: LOGIC CORE (Price, RSI, Trend) ---
async function fetchTechnicalLogic(ticker) {
    // We need 3 endpoints for the full "Validator" logic: Global Quote, RSI, SMA.
    
    // A. PRICE
    const urlPrice = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${API_KEY}`;
    const resPrice = await fetch(urlPrice);
    const jsonPrice = await resPrice.json();
    const price = parseFloat(jsonPrice['Global Quote']['05. price']);
    updateDOM('val-price', '$' + price.toFixed(2));

    // B. RSI (14)
    const urlRSI = `https://www.alphavantage.co/query?function=RSI&symbol=${ticker}&interval=daily&time_period=14&series_type=close&apikey=${API_KEY}`;
    const resRSI = await fetch(urlRSI);
    const jsonRSI = await resRSI.json();
    const rsiData = jsonRSI['Technical Analysis: RSI'];
    const latestDateRSI = Object.keys(rsiData)[0];
    const rsi = parseFloat(rsiData[latestDateRSI]['RSI']);
    
    const rsiEl = document.getElementById('val-rsi');
    rsiEl.innerText = rsi.toFixed(1);
    rsiEl.className = "value " + (rsi > 70 ? "bearish" : rsi < 30 ? "bullish" : "");

    // C. TREND (SMA 200)
    const urlSMA = `https://www.alphavantage.co/query?function=SMA&symbol=${ticker}&interval=daily&time_period=200&series_type=close&apikey=${API_KEY}`;
    const resSMA = await fetch(urlSMA);
    const jsonSMA = await resSMA.json();
    const smaData = jsonSMA['Technical Analysis: SMA'];
    const latestDateSMA = Object.keys(smaData)[0];
    const sma = parseFloat(smaData[latestDateSMA]['SMA']);
    
    const trend = price > sma ? "UP" : "DOWN";
    const trendEl = document.getElementById('val-trend');
    trendEl.innerText = trend;
    trendEl.className = "value " + (trend === "UP" ? "bullish" : "bearish");

    // D. FINAL SIGNAL LOGIC (Nic's Rules)
    let signal = "‚ö†Ô∏è WAIT";
    let signalClass = "";

    if (rsi < 30 && trend === "UP") {
        signal = "üî• PERFECT BUY";
        signalClass = "bullish";
    } else if (rsi < 30 && trend === "DOWN") {
        signal = "‚ö†Ô∏è RISKY DIP";
        signalClass = "bearish";
    } else if (rsi > 70) {
        signal = "‚ùå SELL";
        signalClass = "bearish";
    }

    const sigEl = document.getElementById('val-signal');
    sigEl.innerText = signal;
    sigEl.className = signalClass;
}

// --- ALPHA VANTAGE: NEWS SENTIMENT ---
async function fetchNews(ticker) {
    const url = `https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=${ticker}&limit=3&apikey=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    
    const feed = document.getElementById('news-feed');
    feed.innerHTML = "";

    if(data.feed) {
        data.feed.forEach(item => {
            const sentimentScore = parseFloat(item.overall_sentiment_score);
            let sentClass = "bg-bull";
            let sentText = "BULL";
            
            if(sentimentScore < -0.15) { sentClass = "bg-bear"; sentText = "BEAR"; }
            else if(sentimentScore < 0.15) { sentClass = ""; sentText = "NEUTRAL"; }

            feed.innerHTML += `
                <div class="news-item">
                    <div class="news-meta">
                        <span>${item.source}</span>
                        <span class="sentiment-tag ${sentClass}">${sentText}</span>
                    </div>
                    <a href="${item.url}" target="_blank" class="news-title">${item.title}</a>
                </div>
            `;
        });
    }
}

// --- HELPERS ---
function updateDOM(id, val) {
    const el = document.getElementById(id);
    if(el && val && val !== 'undefined%') el.innerText = val;
    else el.innerText = "--";
}

function formatNumber(num) {
    if(!num) return "--";
    if(num > 1000000000) return (num / 1000000000).toFixed(1) + 'B';
    if(num > 1000000) return (num / 1000000).toFixed(1) + 'M';
    return num;
}
</script>
